var labels={
		"uk":{			
			"hide":"Приховати",
			"alarm":"Аварія",
			"afalstp":"Блок. після аварії",
			"start":"Увімкнено",
			"stop":"Вимкнено",
			"susp":"Призупинено",
			"prep":"Підгот.",
			"run":"Охолодження",
			"gen_sys_data":"Загальні параметри системи",
			"bp_val_opn":"Ступінь відкриття байп. клапана",
			"cool_tot_cap":"Ступінь завант. сист. охолодження",
			"remblock":"Дист. блокування роботи",
			"remreset":"Дист. скидання аварії",
			"eogtemp":"Темп. середовища на виході випарника",
			"eigtemp":"Темп. середовища на вході випарника",
			"evgpress":"Тиск середовища випарника",
			"cowtemp":"Темп-ра води на виході конденсатора",
			"param":"Параметр ",				
			"ch_1_tb_data":"Параметри чилера №1",
			"ch_1_gr_data":"Параметри чилера №1",
			"comp_1":"Комп. №1",
			"ch_2_tb_data":"Параметри чилера №2",
			"ch_2_gr_data":"Параметри чилера №2",
			"comp_2":"Комп. №2",
			"ct_data":"Параметри контура градирні",
			"state":"Статус",
			"setpoint":"Уставка",
			"last_alarm":"Остання аварія",
			"cmp_on":"Стан компресора",
			"cmpdsh":"Перегрів на нагнітанні",
			"cmpdt":"Температура нагнітання (мастила)",
			"cmphp":"Тиск нагнітання",
			"cmplp":"Тиск всмоктування",
			"cmpop":"Тиск мастила",
			"cmpofdp":"Перепад тиску на фільтрі мастила",
			"cmpssh":"Перегрів у випарнику",
			"cmpvop":"Відкриття РВ випарника",
			"motcldng":"Завантаження",
			"motcurra":"Струм двигуна",
			"motcurrp":"Потужність двигуна",
			"motcurpf":"Коеф. потужності двигуна",
			"cmpwrkh":"Час напрацювання",
			"motcvolt":"Напруга двигуна",
			"motcvola":"Асиметрія напруги",
			"ct_witemp":"Температура води на вході",
			"ct_wotmp":"Температура води на зливі",
			"ct_fancp":"Продуктивність вентилятора",
			"ct_wdrn":"Дренаж води",
			"ct_fan":"Вентилятор",
			"ct_ckt":"Контур гадирні",
			"clng":"Охолодження",
			"med_cls":"Зближення температур середовищ ТО",
			"fct_pmp":"Подача на виробництво",
			"fct_tmpp":"Темп. води на подачі на вир-во (тиск)",
			"hex_otmp":"Темп. води на виході ТО",
			"hex_itmp":"Темп. води на вході ТО",
			"ct_wcnd":"Провідність води",
			"amb_temp":"Температура повітря",
			"amb_humd":"Вологість повітря",
			"ctpsuc":"Тиск на всмоктуванні насоса",
			"reset":"Скидання аварії",
			"block":"Заблоковано",
			"unblock":"Розблоковано",
			"value":"Значення ",
			"out_rng":" поза допустимими межами",
			"is_crtl":" є критичним",
			"crtl_st":"Критичний стан",
			"no_data":"Немає даних",
			"no_alwd":"Не доступно",
			"wronginput":"Невірне введення",
			"no_alwd_ab":"Н/Д"
		},
		"ru":{			
			"hide":"Скрыть",
			"alarm":"Авария",
			"afalstp":"Блок. после аварии",	
			"start":"Включен",
			"stop":"Выключен",
			"susp":"Приостановлен",
			"prep":"Подгот.",
			"run":"Охлаждение",
			"gen_sys_data":"Общие параметры системы",
			"bp_val_opn":"Степень открытия байп. клапана",
			"cool_tot_cap":"Степень загрузки сист. охлаждения",
			"remblock":"Дист. блокировка работы",
			"remreset":"Дист. сброс аварии",
			"eogtemp":"Темп. среды на выходе испарителя",
			"eigtemp":"Темп. среды на входе испарителя",
			"evgpress":"Давление среды испарителя",
			"cowtemp":"Темп. воды на выходе конденсатора",
			"param":"Параметр ",						
			"ch_1_tb_data":"Параметры чиллера №1",
			"ch_1_gr_data":"Параметры чиллера №1",
			"comp_1":"Комп. №1",
			"ch_2_tb_data":"Параметры чиллера №2",
			"ch_2_gr_data":"Параметры чиллера №2",
			"comp_2":"Комп. №2",
			"ct_data":"Параметры контура градирни",
			"state":"Статус",
			"setpoint":"Уставка",
			"compdata":"Параметры компрессора",
			"last_alarm":"Последняя авария",
			"cmp_on":"Состояние компрессора",
			"cmpdsh":"Перегрев на нагнетании",
			"cmpdt":"Температура нагнетания (масла)",
			"cmphp":"Давление нагнетания",
			"cmplp":"Давление всасывания",
			"cmpop":"Давление масла",
			"cmpofdp":"Перепад давления на фильтре масла",
			"cmpssh":"Перегрев в испарителе",
			"cmpvop":"Открытие РВ испарителя",
			"motcldng":"Загрузка",
			"motcurra":"Ток двигателя",
			"motcurrp":"Мощность двигателя",
			"motcurpf":"Коэфф. мощности двигателя",
			"cmpwrkh":"Время наработки",
			"motcvolt":"Напряжение двигателя",
			"motcvola":"Асимметрия напряжения",
			"ct_witemp":"Температура воды на входе",
			"ct_wotmp":"Температура воды на сливе",
			"ct_fancp":"Производительность вентилятора",
			"ct_wdrn":"Дренаж воды",
			"ct_fan":"Вентилятор",
			"ct_ckt":"Контур градирни",
			"clng":"Охлаждение воды",
			"med_cls":"Сближение температур сред ТО",
			"fct_pmp":"Подача на производство",
			"fct_tmpp":"Темп. воды на подаче на пр-во (давл.)",
			"hex_otmp":"Темп. воды на выходе ТО",
			"hex_itmp":"Темп. воды на входе ТО",
			"ct_wcnd":"Проводимость воды",
			"amb_temp":"Температура воздуха",
			"amb_humd":"Влажность воздуха",
			"ctpsuc":"Давление на всасывании насоса",
			"reset":"Сброс аварии",
			"block":"Заблокировано",
			"unblock":"Разблокировано",
			"value":"Значение ",
			"out_rng":" вне допустимых пределов",
			"is_crtl":" явл. критическим",
			"crtl_st":"Критическое состояние",
			"no_data":"Нет данных",
			"no_alwd":"Не доступно",
			"wronginput":"Неверный ввод",
			"no_alwd_ab":"Н/Д"
		},
		"en":{
			"hide":"Hide",	
			"alarm":"Alarm",
			"afalstp":"After alarm block",
			"start":"Started",
			"stop":"Stopped",
			"susp":"Suspended",
			"prep":"Preparing",
			"run":"Cooling",
			"gen_sys_data":"System general data",
			"bp_val_opn":"Bypass valve opening",
			"cool_tot_cap":"Cooling plant total capacity",
			"remblock":"Remote blocking",
			"remreset":"Remote alarm reset",
			"eogtemp":"Evaporator media outlet temperature",
			"eigtemp":"Evaporator media inlet temperature",
			"evgpress":"Evaporator media pressure",
			"cowtemp":"Condenser water outlet temperature",				
			"ch_1_tb_data":"Parameters of Chiller #1",		
			"ch_1_gr_data":"Parameters of Chiller #1",
			"comp_1":"Comp.#1",			
			"ch_2_tb_data":"Parameters of Chiller #2",		
			"ch_2_gr_data":"Parameters of Chiller #2",
			"comp_2_data":"Comp. #2",
			"ct_data":"Cooling tower circuit data",
			"state":"State",
			"setpoint":"Media outlet etpoint",
			"compdata":"Compressor data",
			"last_alarm":"Last fault",
			"cmp_on":"Compressor status",
			"cmpdsh":"Discharge superheat",
			"cmpdt":"Oil Tmp",
			"cmphp":"Discharge pressure",
			"cmplp":"Suction pressure",
			"cmpop":"Oil pressure",
			"cmpofdp":"Oil filter pressure drop",
			"cmpssh":"Evaporator superheat",
			"cmpvop":"EEV opening",
			"cmpwrkh":"Running time",
			"motcldng":"Capacity",
			"motcurra":"Motor current",
			"motcurrp":"Motor power",
			"motcurpf":"Motor power factor",
			"motcvolt":"Motor voltage",
			"motcvola":"Voltage asymmetry",
			"ct_witemp":"Inlet water temperature",
			"ct_wotmp":"Outlet water temperature",
			"ct_fancp":"Fan motor capacity",
			"ct_wdrn":"Water drain",
			"ct_fan":"Fan",
			"ct_ckt":"Cooling tower circuit",
			"clng":"Water cooling",
			"med_cls":"Heat exchanger media temperature approach",
			"fct_pmp":"Production water pump",
			"fct_tmpp":"Production outg. water temp. (pressure)",
			"hex_otmp":"Heat exchanger outlet water temp.",
			"hex_itmp":"Heat exchanger inlet water temp.",
			"ct_wcnd":"Water conductivity",
			"amb_temp":"Air temperature",
			"amb_humd":"Air humidity",
			"ctpsuc":"Pump suction pressure",
			"reset":"Reset alarm",
			"block":"Blocked",
			"unblock":"Unblocked",
			"value":"Value ",
			"out_rng":" is out of range",
			"is_crtl":" is critical",
			"crtl_st":"Critical state",
			"no_data":"No data",
			"no_alwd":"Not allowed",
			"wronginput":"Wrong input",
			"no_alwd_ab":"N/A"
		}
}

var alarmcode={
		"uk":{
			null:"Немає даних",
			"0":"Аварії відсутні",
			"1":"Аварійна зупинка",
			"2":"Відсутність протоку випарника",
			"3":"Відсутність протоку проміжного ТО",
			"4":"Загроза замерзання середовища випарника",
			"5":"Пот. загроза замерзання середовища випарника",
			"6":"Неспр. периф. обладн. (ЩКПП: мережа, захист насосів вип., ТО, тиск сер. вип. ХМ)",
			"7":"Відсутність протоку конденсатора К1",
			"8":"Низький рівень мастила К1",
			"9":"Низька температура мастила К1",
			"10":"Висока температура мастила К1",
			"11":"Низький перегрів на нагнітанні К1",
			"12":"Несправність ДЕРВ К1",
			"13":"Аварія запуску К1",
			"14":"Перегрів К1 (е/д, нагнітання)",
			"15":"Перевантаження двигуна К1",
			"16":"Електронний захист двигуна К1",
			"17":"Низький тиск всмоктування К1",
			"18":"Високий тиск нагнітання К1",
			"19":"К1 по-за межами застосування",
			"20":"Низький тиск мастила К1",
			"21":"Забруднення фільтру мастила К1",
			"22":"Відсутність протоку конденсатора К2",
			"23":"Низький рівень мастила К2",
			"24":"Низька температура мастила К2",
			"25":"Висока температура мастила К2",
			"26":"Низький перегрів на нагнітанні К2",
			"27":"Несправність ДЕРВ К2",
			"28":"Аварія запуску К2",
			"29":"Перегрів К2 (е/д, нагнітання)",
			"30":"Перевантаження двигуна К2",
			"31":"Електронний захист двигуна К2",
			"32":"Низький тиск всмоктування К2",
			"33":"Високий тиск нагнітання К2",
			"34":"К2 по-за межами застосування",
			"35":"Низький тиск мастила К2",
			"36":"Забруднення фільтру мастила К2",
			"37":"Несправність датчика S1",
			"38":"Несправність датчика S2",
			"39":"Несправність датчика S3",
			"40":"Несправність датчика S4",
			"41":"Несправність датчика S5",
			"42":"Несправність датчика S6",
			"43":"Несправність датчика S7",
			"44":"Несправність датчика S8",
			"45":"Несправність датчика S9",
			"46":"Несправність датчика S10",
			"47":"Несправність датчика S11",
			"48":"Несправність датчика S12",
			"49":"Несправність датчика S13",
			"50":"Несправність датчика S14"
		},
		"ru":{
			null:"Нет данных",
			"0":"Аварии отсутствуют",
			"1":"Аварийная остановка",
			"2":"Отсутствие протока испарителя",
			"3":"Отсутствие протока промежуточного ТО",
			"4":"Угроза замерзания среды испарителя",
			"5":"Пот. угроза замерзания среды испарителя",
			"6":"Неиспр. периф. оборуд. (ЩУПУ: сеть, защ. насосов исп., ТО, давл. среды исп.)",
			"7":"Отсутствие протока конденсатора К1",
			"8":"Низкий уровень масла К1",
			"9":"Низкая температура масла К1",
			"10":"Высокая температура масла К1",
			"11":"Низкий перегрев на нагнетании К1",
			"12":"Неисправность ДЭРВ К1",
			"13":"Авария запуска К1",
			"14":"Перегрев К1 (э/д, нагнетание)",
			"15":"Перегруз двигателя К1",
			"16":"Электронная защита двигателя К1",
			"17":"Низкое давление всасывания К1",
			"18":"Высокое давление нагнетания К1",
			"19":"К1 вне пределов применения",
			"20":"Низкое давление масла К1",
			"21":"Загрязнение фильтра масла К1",
			"22":"Отсутствие протока конденсатора К2",
			"23":"Низкий уровень масла К2",
			"24":"Низкая температура масла К2",
			"25":"Высокая температура масла К2",
			"26":"Низкий перегрев на нагнетании К2",
			"27":"Неисправность ДЭРВ К2",
			"28":"Авария запуска К2",
			"29":"Перегрев К2 (э/д, нагнетание)",
			"30":"Перегруз двигателя К2",
			"31":"Электронная защита двигателя К2",
			"32":"Низкое давление всасывания К2",
			"33":"Высокое давление нагнетания К2",
			"34":"К2 вне пределов применения",
			"35":"Низкое давление масла К2",
			"36":"Загрязнение фильтра масла К2",
			"37":"Неисправность датчика S1",
			"38":"Неисправность датчика S2",
			"39":"Неисправность датчика S3",
			"40":"Неисправность датчика S4",
			"41":"Неисправность датчика S5",
			"42":"Неисправность датчика S6",
			"43":"Неисправность датчика S7",
			"44":"Неисправность датчика S8",
			"45":"Неисправность датчика S9",
			"46":"Неисправность датчика S10",
			"47":"Неисправность датчика S11",
			"48":"Неисправность датчика S12",
			"49":"Неисправность датчика S13",
			"50":"Неисправность датчика S14"
		},
		"en":{
			null:"No data",
			"0": "No alarms",
			"1": "Emergency stop",
			"2": "Evaporator medium flow alarm",
			"3": "Heat exchanger water flow alarm",
			"4": "Evaporator medium freezing alarm",
			"5": "Pot. evaporator medium freezing alarm",
			"6": "Periph. equip. fault (PECU: mains, evap. or h-ex. pumps prot., or evap. media press.)",
			"7": "C1 condenser water flow alarm",
			"8": "C1 low oil level",
			"9": "C1 low oil temperature",
			"10": "C1 high oil temperature",
			"11": "C1 low discharge superheat",
			"12": "C1 EVD fault",
			"13": "C1 starting fault",
			"14": "C1 overheating  (motor, discharge)",
			"15": "C1 motor overload",
			"16": "C1 electronic motor protection",
			"17": "C1 low suction pressure",
			"18": "C1 high discharge pressure",
			"19": "C1 out of limits",
			"20": "C1 low oil pressure",
			"21": "C1 oil filter contamination",
			"22": "C2 condenser water flow alarm",
			"23": "C2 low oil level",
			"24": "C2 low oil temperature",
			"25": "C2 high oil temperature",
			"26": "C2 low discharge superheat",
			"27": "C2 EVD fault",
			"28": "C2 starting fault",
			"29": "C2 overheating  (motor, discharge)",
			"30": "C2 motor overload",
			"31": "C2 electronic motor protection",
			"32": "C2 low suction pressure",
			"33": "C2 high discharge pressure",
			"34": "C2 out of limits",
			"35": "C2 low oil pressure",
			"36": "C2 oil filter contamination",
			"37": "S1 sensor fault",
			"38": "S2 sensor fault",
			"39": "S3 sensor fault",
			"40": "S4 sensor fault",
			"41": "S5 sensor failure",
			"42": "S6 sensor fault",
			"43": "S7 sensor fault",
			"44": "S8 sensor fault",
			"45": "S9 sensor fault9",
			"46": "S10 sensor fault",
			"47": "S11 sensor fault",
			"48": "S12 sensor fault",
			"49": "S13 sensor fault",
			"50": "S14 sensor fault"
		}
	}

var titleLabels = {
	"uk":{
		'zone': "Зона",
		'recycle': 'Блок рециркуляції',
		'vent': 'Витяжний вентилятор',
		'incom': 'Приточний блок',
		'mode': 'Режим',
		'temperature': 'Температура',
		'humidity': 'Отн. влажность'
	},
	"ru":{
		'zone': "Зона",
		'recycle': 'Блок рециркуляции',
		'vent': 'Вытяжной вентилятор',
		'incom': 'Приточний блок',
		'mode': 'Режим',
		'temperature': 'Температура',
		'humidity': 'Відн. вологість'
	},
	"en":{
		'zone': "Zone",
		'recycle': 'Recycling unit',
		'vent': 'Exhaust fan',
		'incom': 'Fresh air unit',
		'mode': 'Mode',
		'temperature': 'Temperature',
		'humidity': 'Rel. humidity'
	}
};

// номера с распределением по зонам, для лейблов блоков и сквозной нумерации.

var unitNumbers = {
	zone1: {
		vent: [2, 1],
		recycle: [1, 2, 5],
		incom: [2]
	},
	zone2:{
		vent: [3],
		recycle: [6],
		incom: [1]
	},
	zone3:{
		vent: [4, 5],
		recycle: [3, 4, 7],
		incom: [3]
	},
	zone4:{
		vent: [6],
		recycle: [8],
		incom: [5]
	},
	zone5:{
		vent: [7],
		recycle: [10],
		incom: [4]
	},
	zone6:{
		vent: [8],
		recycle: [9],
		incom: [6]
	}
}


// массив с координатами датчиков влажности и температуры

var sensorsCoord = [
	{x: 674, y: 159},
	{x: 915, y: 159},
	{x: 1237, y: 159},
	{x: 1237, y: 401},
	{x: 995, y: 280},
	{x: 835, y: 280},
	{x: 593, y: 401},
	{x: 915, y: 401},
	{x: 593, y: 280},
	{x: 754, y: 518},
	{x: 1076, y: 518},
	{x: 1237, y: 518},
	{x: 1237, y: 763},
	{x: 996, y: 642},
	{x: 915, y: 642},
	{x: 754, y: 642},
	{x: 835, y: 763},
	{x: 1076, y: 763},
	{x: 1237, y: 885},
	{x: 754, y: 885},
];


// Направляющие для точек вентиляции, горизонтальные направляющие - r* (row*), вертикальные - c* (column*)
// важно заметить что нижние и верхние находятся на разных вертикалях, но нумерация колонок идет слева направо без сбивания порядка

var constraints = {
	r1: 214,
	c1: 533
};

constraints.r2 = constraints.r1 + 90;
constraints.r3 = constraints.r2 + 90;
constraints.r4 = constraints.r3 + 90;
constraints.r5 = constraints.r4 + 100;
constraints.r6 = constraints.r5 + 90;
constraints.r7 = constraints.r6 + 90;
constraints.r8 = constraints.r7 + 90;

constraints.c2 = constraints.c1 + 120;
constraints.c3 = constraints.c2 + 141;
constraints.c4 = constraints.c3 + 80;
constraints.c5 = constraints.c4 + 142;
constraints.c6 = constraints.c5 + 80;
constraints.c7 = constraints.c6 + 120;


function placelabels(){
	
	labelproc($("#Z1P1Details"),$("#basepic"),constraints.c2,constraints.r1,"center","center",1);
	labelproc($("#Z1P2Details"),$("#basepic"),constraints.c1,constraints.r2,"center","center",1);
	labelproc($("#Z1P3Details"),$("#basepic"),constraints.c2,constraints.r2,"center","center",1);
	labelproc($("#Z1P4Details"),$("#basepic"),constraints.c1,constraints.r3,"center","center",1);
	labelproc($("#Z1P5Details"),$("#basepic"),constraints.c1,constraints.r4,"center","center",1);
	labelproc($("#Z1P6Details"),$("#basepic"),constraints.c2,constraints.r4,"center","center",1);

	labelproc($("#Z2P1Details"),$("#basepic"),constraints.c4,constraints.r2,"center","center",1);
	labelproc($("#Z2P2Details"),$("#basepic"),constraints.c4,constraints.r3,"center","center",1);
	labelproc($("#Z2P3Details"),$("#basepic"),constraints.c4,constraints.r4,"center","center",1);

	labelproc($("#Z3P1Details"),$("#basepic"),constraints.c7,constraints.r1,"center","center",1);
	labelproc($("#Z3P2Details"),$("#basepic"),constraints.c6,constraints.r2,"center","center",1);
	labelproc($("#Z3P3Details"),$("#basepic"),constraints.c7,constraints.r2,"center","center",1);
	labelproc($("#Z3P4Details"),$("#basepic"),constraints.c6,constraints.r3,"center","center",1);
	labelproc($("#Z3P5Details"),$("#basepic"),constraints.c6,constraints.r4,"center","center",1);
	labelproc($("#Z3P6Details"),$("#basepic"),constraints.c7,constraints.r4,"center","center",1);

	labelproc($("#Z4P1Details"),$("#basepic"),constraints.c3,constraints.r5,"center","center",1);
	labelproc($("#Z4P2Details"),$("#basepic"),constraints.c3,constraints.r6,"center","center",1);
	labelproc($("#Z4P3Details"),$("#basepic"),constraints.c3,constraints.r7,"center","center",1);

	labelproc($("#Z5P1Details"),$("#basepic"),constraints.c5,constraints.r6,"center","center",1);
	labelproc($("#Z5P2Details"),$("#basepic"),constraints.c5,constraints.r7,"center","center",1);
	labelproc($("#Z5P3Details"),$("#basepic"),constraints.c5,constraints.r8,"center","center",1);

	labelproc($("#Z6P1Details"),$("#basepic"),constraints.c7,constraints.r5,"center","center",1);
	labelproc($("#Z6P2Details"),$("#basepic"),constraints.c7,constraints.r6,"center","center",1);
	labelproc($("#Z6P3Details"),$("#basepic"),constraints.c7,constraints.r7,"center","center",1);

	labelproc($("#zone1Info"),$("#basepic"),650,385,"center","center",1);
	labelproc($("#zone2Info"),$("#basepic"),870,215,"center","center",1);
	labelproc($("#zone3Info"),$("#basepic"),1215,385,"center","center",1);
	labelproc($("#zone4Info"),$("#basepic"),791,835,"center","center",1);
	labelproc($("#zone5Info"),$("#basepic"),1015,590,"center","center",1);
	labelproc($("#zone6Info"),$("#basepic"),1215,835,"center","center",1);

	sensorsCoord.map((point, index) => {
		labelproc($("#sensor"+(index+1)),$("#basepic"),point.x,point.y,"center","center",1);
	});

}

function checkAlarmState(key){
	// console.log(key, key.includes('FAULT'));
	if (key.includes('REMDEFLT') || !(key.includes('FAULT') || key.includes('FLT') || key.includes('FALT'))){
		return;
	}

	if (VarValues[key] != 1){
		return;
	}

	var alarmType = key.substr(2,5);
	alarmType = alarmType.replace('FA','').replace('F', '');

	var alarmZone = key.substr(1,1);

	if (alarmType == 'UNIT' || alarmType == 'MAINS' || alarmType.includes('SB')){
		// general zone alarm, show alarm sign on that zone.
		if ( VarValues[key] ) {
			$('#zone'+alarmZone+'Info .alarmSign').addClass('visible');
			if (!$('#'+key).length ) {
				$('#zone'+alarmZone+'Info .alarmsList').append('<div id="'+key+'">'+VarGroup[key].description[curr_lang].replace('(#'+alarmZone+') ','').replace('(№'+alarmZone+') ','')+'</div>')
			}
		} else {
			$('#'+key).remove();
		}

		if (!$('#zone'+alarmZone+'Info .alarmsList div').length){
			$('#zone'+alarmZone+'Info .alarmSign').removeClass('visible');
		}

	} else if (alarmType == "RU") {
		if ( VarValues[key] ) {
			$('[data-point-type="Z'+alarmZone+'incom1"]').addClass('alarm');
		} else {
			$('[data-point-type="Z'+alarmZone+'incom1"]').removelass('alarm');
		}

	} else if (alarmType.includes('RECU')) {
		if ( VarValues[key] ) {
			$('.Z'+alarmZone+'recycle'+(alarmType.substr(4,1) || 1)+'alarm').addClass('visible');
		} else {
			$('.Z'+alarmZone+'recycle'+(alarmType.substr(4,1) || 1)+'alarm').removeClass('visible');
		}
	} else if (alarmType.includes('EXHT')) {
		if ( VarValues[key] ) {
			$('.Z'+alarmZone+'vent'+(alarmType.substr(4,1) || 1)+'alarm').addClass('visible');
		} else {
			$('.Z'+alarmZone+'vent'+(alarmType.substr(4,1) || 1)+'alarm').removeClass('visible');
		}
	}
}

function showZoneControls(zoneElement){
	if (curr_auth_lev == "0" || SrvStat["mb"]["scanning"] !== "true" || $(zoneElement).find('.zoneControls').hasClass('visible')){
		return;
	}
	$(zoneElement).find('.zoneControls').addClass('visible');
	placelabels();
}

function switchZoneMode(zone, event){
	event.preventDefault();
	event.stopPropagation();
	if (SrvStat["mb"]["scanning"] !== "true"){
		return;
	}
	var varName = 'Z'+zone+'OPRGMODE';
	var newOpt = {}
	newOpt[varName] = $('input[name="zone'+zone+'-control"]:checked').val();
	SendData("setvarval", curr_auth_req, newOpt, VarNodes['Z'+zone+'OPRGMODE']);
	VarValues['Z'+zone+'OPRGMODE'] = $('input[name="zone'+zone+'-control"]:checked').val();
	$('#zone'+zone+'Info').find('.zoneControls').removeClass('visible');

	placelabels();
}

function cancelModeSwitching(zone, event) {
	event.preventDefault();
	event.stopPropagation();
	if (!$('#zone'+zone+'Info').find('.zoneControls').hasClass('visible')){
		return;
	}
	$('#zone'+zone+'Info').find('.zoneControls').removeClass('visible');
	placelabels();
}

function definePointType(pointId, zone){
	var pointType = 'not defined';
	if (zone === 1 || zone === 3){
		pointType = (pointId === 1 || pointId === 4) ? 'vent' : (pointId === 6) ? 'incom' : 'recycle';
	} else if (zone === 4 || zone === 6){
		pointType = (pointId === 1) ? 'vent' : (pointId === 3) ? 'incom' : 'recycle';
	} else if (zone === 5) {
		pointType = (pointId === 3) ? 'vent' : (pointId === 1) ? 'incom' : 'recycle';
	} else {
		pointType = (pointId === 2) ? 'vent' : (pointId === 1) ? 'incom' : 'recycle';
	}

	return pointType;
}

function showPointData(pointId, zone) {
	if (!pointId && pointId !== 0 && !zone && zone !== 0){
		return;
	}
	var target = $('#Z'+zone+'P'+pointId+'DataFrame');
	if (target.hasClass('frameVisible')) {
		$('.AddData').css('z-index', '9');
		target.css('z-index', '10');
	} else {
		$('.AddData').css('z-index', '9');
		target.show().css('z-index', '10').addClass('frameVisible');
	}
}

function generateRowValue(rowObj, varName){
	var result = '';
	var variableName = rowObj.varName || varName;
	if (rowObj.type === "BOOL"){
		// TODO - adjust on/off states depending on var name like 'locked'/'unlocked', blocked/released etc.
		// TODO - add translations
		if (!variableName.includes('REMDEFLT') && (variableName.includes('FAULT') || variableName.includes('FLT') || variableName.includes('FALT'))){
			result = (VarValues[variableName] != '0') ? "АВАРИЯ" : "Отсутствуют";
		} else {
			result = (VarValues[variableName] != '0') ? "Включено" : "Выключено";
		}
	} else if (rowObj.type === "FIXED") {
		result = parseFloat(VarValues[variableName]).toFixed(rowObj.roundto);
	} else if (rowObj.type === "INTEGER") {
		result = parseInt(VarValues[variableName]).toFixed(rowObj.roundto);
	}
	result = '<b>'+result+'</b><span>'+rowObj.dataunits+'</span>';
	return result;
}

function generatePointData(pointId, zone, pointTypeNumber){
	if (!pointId && pointId !== 0 && !zone && zone !== 0){
		return;
	}

	// if (pointType === 'vent'){
	// 	return;
	// }

	var pointType = definePointType(pointId, zone);

	var pointDataArray = [];

	if (pointType === 'incom'){
		if (VarGroup['Z'+zone+'B1CURVAL']) {
			VarGroup['Z'+zone+'B1CURVAL'].varName = 'Z'+zone+'B1CURVAL';
			pointDataArray.push(VarGroup['Z'+zone+'B1CURVAL']);
		}
		if (VarGroup['Z'+zone+'B2CURVAL']) {
			VarGroup['Z'+zone+'B2CURVAL'].varName = 'Z'+zone+'B2CURVAL';
			pointDataArray.push(VarGroup['Z'+zone+'B2CURVAL']);
		}
		if (VarGroup['Z'+zone+'B3CURVAL']) {
			VarGroup['Z'+zone+'B3CURVAL'].varName = 'Z'+zone+'B3CURVAL';
			pointDataArray.push(VarGroup['Z'+zone+'B3CURVAL']);
		}
		if (VarGroup['Z'+zone+'FARUVLVO']) {
			VarGroup['Z'+zone+'FARUVLVO'].varName = 'Z'+zone+'FARUVLVO';
			pointDataArray.push(VarGroup['Z'+zone+'FARUVLVO']);
		}
		if (VarGroup['Z'+zone+'FARURBLK']) {
			VarGroup['Z'+zone+'FARURBLK'].varName = 'Z'+zone+'FARURBLK';
			pointDataArray.push(VarGroup['Z'+zone+'FARURBLK']);
		}
		if (VarGroup['Z'+zone+'FARUFAVO']) {
			VarGroup['Z'+zone+'FARUFAVO'].varName = 'Z'+zone+'FARUFAVO';
			pointDataArray.push(VarGroup['Z'+zone+'FARUFAVO']);
		}
		if (VarGroup['Z'+zone+'FARUTRTM']) {
			VarGroup['Z'+zone+'FARUTRTM'].varName = 'Z'+zone+'FARUTRTM';
			pointDataArray.push(VarGroup['Z'+zone+'FARUTRTM']);
		}
		if (VarGroup['Z'+zone+'FARUSTRT']) {
			VarGroup['Z'+zone+'FARUSTRT'].varName = 'Z'+zone+'FARUSTRT';
			pointDataArray.push(VarGroup['Z'+zone+'FARUSTRT']);
		}
		if (VarGroup['Z'+zone+'FARUFALT']) {
			VarGroup['Z'+zone+'FARUFALT'].varName = 'Z'+zone+'FARUFALT';
			pointDataArray.push(VarGroup['Z'+zone+'FARUFALT']);
		}
	} else {
		if (zone === 1 || zone === 3){
			if (pointType === 'recycle') {
				if (VarGroup['Z'+zone+'REC'+pointTypeNumber+'TRTM']) {
					VarGroup['Z'+zone+'REC'+pointTypeNumber+'TRTM'].varName = 'Z'+zone+'REC'+pointTypeNumber+'TRTM';
					pointDataArray.push(VarGroup['Z'+zone+'REC'+pointTypeNumber+'TRTM']);
				}
				if (VarGroup['Z'+zone+'REC'+pointTypeNumber+'STRT']) {
					VarGroup['Z'+zone+'REC'+pointTypeNumber+'STRT'].varName = 'Z'+zone+'REC'+pointTypeNumber+'STRT';
					pointDataArray.push(VarGroup['Z'+zone+'REC'+pointTypeNumber+'STRT']);
				}
				if (VarGroup['Z'+zone+'REC'+pointTypeNumber+'RBLK']) {
					VarGroup['Z'+zone+'REC'+pointTypeNumber+'RBLK'].varName = 'Z'+zone+'REC'+pointTypeNumber+'RBLK';
					pointDataArray.push(VarGroup['Z'+zone+'REC'+pointTypeNumber+'RBLK']);
				}
				if (VarGroup['Z'+zone+'RCRU'+pointTypeNumber+'VLO']) {
					VarGroup['Z'+zone+'RCRU'+pointTypeNumber+'VLO'].varName = 'Z'+zone+'RCRU'+pointTypeNumber+'VLO';
					pointDataArray.push(VarGroup['Z'+zone+'RCRU'+pointTypeNumber+'VLO']);
				}
				if (pointTypeNumber == 1) {
					if (VarGroup['Z'+zone+'B4CURVAL']) {
						VarGroup['Z'+zone+'B4CURVAL'].varName = 'Z'+zone+'B4CURVAL';
						pointDataArray.push(VarGroup['Z'+zone+'B4CURVAL']);
					}
					if (VarGroup['Z'+zone+'B5CURVAL']) {
						VarGroup['Z'+zone+'B5CURVAL'].varName = 'Z'+zone+'B5CURVAL';
						pointDataArray.push(VarGroup['Z'+zone+'B5CURVAL']);
					}
				} else if (pointTypeNumber == 2) {
					if (VarGroup['Z'+zone+'B6CURVAL']) {
						VarGroup['Z'+zone+'B6CURVAL'].varName = 'Z'+zone+'B6CURVAL';
						pointDataArray.push(VarGroup['Z'+zone+'B6CURVAL']);
					}
					if (VarGroup['Z'+zone+'B7CURVAL']) {
						VarGroup['Z'+zone+'B7CURVAL'].varName = 'Z'+zone+'B7CURVAL';
						pointDataArray.push(VarGroup['Z'+zone+'B7CURVAL']);
					}
				} else {
					if (VarGroup['Z'+zone+'B8CURVAL']) {
						VarGroup['Z'+zone+'B8CURVAL'].varName = 'Z'+zone+'B8CURVAL';
						pointDataArray.push(VarGroup['Z'+zone+'B8CURVAL']);
					}
					if (VarGroup['Z'+zone+'B9CURVAL']) {
						VarGroup['Z'+zone+'B9CURVAL'].varName = 'Z'+zone+'B9CURVAL';
						pointDataArray.push(VarGroup['Z'+zone+'B9CURVAL']);
					}
				}
				if (VarGroup['Z'+zone+'RECU'+pointTypeNumber+'FLT']){
					VarGroup['Z'+zone+'RECU'+pointTypeNumber+'FLT'].varName = 'Z'+zone+'RECU'+pointTypeNumber+'FLT';
					pointDataArray.push(VarGroup['Z'+zone+'RECU'+pointTypeNumber+'FLT']);
				}
			} else if (pointType === 'vent') {
				if (VarGroup['Z'+zone+'EXH'+pointTypeNumber+'STRT']){
					VarGroup['Z'+zone+'EXH'+pointTypeNumber+'STRT'].varName = 'Z'+zone+'EXH'+pointTypeNumber+'STRT';
					pointDataArray.push(VarGroup['Z'+zone+'EXH'+pointTypeNumber+'STRT']);
				}
				if (VarGroup['Z'+zone+'EXH'+pointTypeNumber+'RBLK']){
					VarGroup['Z'+zone+'EXH'+pointTypeNumber+'RBLK'].varName = 'Z'+zone+'EXH'+pointTypeNumber+'RBLK';
					pointDataArray.push(VarGroup['Z'+zone+'EXH'+pointTypeNumber+'RBLK']);
				}
				if (VarGroup['Z'+zone+'EXHT'+pointTypeNumber+'FLT']) {
					VarGroup['Z'+zone+'EXHT'+pointTypeNumber+'FLT'].varName = 'Z'+zone+'EXHT'+pointTypeNumber+'FLT';
					pointDataArray.push(VarGroup['Z'+zone+'EXHT'+pointTypeNumber+'FLT']);
				}
			}
		} else {
			if (pointType === 'recycle') {
				if (VarGroup['Z'+zone+'RECUTRTM']) {
					VarGroup['Z'+zone+'RECUTRTM'].varName = 'Z'+zone+'RECUTRTM';
					pointDataArray.push(VarGroup['Z'+zone+'RECUTRTM']);
				}
				if (VarGroup['Z'+zone+'RECUSTRT']) {
					VarGroup['Z'+zone+'RECUSTRT'].varName = 'Z'+zone+'RECUSTRT';
					pointDataArray.push(VarGroup['Z'+zone+'RECUSTRT']);
				}
				if (VarGroup['Z'+zone+'RECURBLK']) {
					VarGroup['Z'+zone+'RECURBLK'].varName = 'Z'+zone+'RECURBLK';
					pointDataArray.push(VarGroup['Z'+zone+'RECURBLK']);
				}
				if (VarGroup['Z'+zone+'RCRUVLVO']) {
					VarGroup['Z'+zone+'RCRUVLVO'].varName = 'Z'+zone+'RCRUVLVO';
					pointDataArray.push(VarGroup['Z'+zone+'RCRUVLVO']);
				}
				if (VarGroup['Z'+zone+'B4CURVAL']) {
					VarGroup['Z'+zone+'B4CURVAL'].varName = 'Z'+zone+'B4CURVAL';
					pointDataArray.push(VarGroup['Z'+zone+'B4CURVAL']);
				}
				if (VarGroup['Z'+zone+'B5CURVAL']) {
					VarGroup['Z'+zone+'B5CURVAL'].varName = 'Z'+zone+'B5CURVAL';
					pointDataArray.push(VarGroup['Z'+zone+'B5CURVAL']);
				}
				if (VarGroup['Z'+zone+'RECUFALT']) {
					VarGroup['Z'+zone+'RECUFALT'].varName = 'Z'+zone+'RECUFALT';
					pointDataArray.push(VarGroup['Z'+zone+'RECUFALT']);
				}
			} else if (pointType === 'vent') {
				if (VarGroup['Z'+zone+'EXHTSTRT']) {
					VarGroup['Z'+zone+'EXHTSTRT'].varName = 'Z'+zone+'EXHTSTRT';
					pointDataArray.push(VarGroup['Z'+zone+'EXHTSTRT']);
				}
				if (VarGroup['Z'+zone+'EXHTRBLK']) {
					VarGroup['Z'+zone+'EXHTRBLK'].varName = 'Z'+zone+'EXHTRBLK';
					pointDataArray.push(VarGroup['Z'+zone+'EXHTRBLK']);
				}
				if (VarGroup['Z'+zone+'EXHTFALT']) {
					VarGroup['Z'+zone+'EXHTFALT'].varName = 'Z'+zone+'EXHTFALT';
					pointDataArray.push(VarGroup['Z'+zone+'EXHTFALT']);
				}
			}
		}
	}

	var generatedFrame = "";

	var frameContent = "";

	for (var i = 0; i < pointDataArray.length; i++){

		frameContent += "<div class='row' style=\""+(parseInt(pointDataArray[i].hidden) > parseInt(window.curr_auth_lev) ? 'display:none;' : '')+"\" data-variable-name="+pointDataArray[i].varName+">"
											+"<div class='rowLabel'>"
													+(pointDataArray[i].description[curr_lang].replace('(#'+zone+') ','').replace('(№'+zone+') ',''))
												+"</div>"
												+"<div class='rowValue'>"
													+generateRowValue(pointDataArray[i])
													+'<div class="actualityDisclaimer">'
														+'Устаревшее значение'
													+'</div>'
												+"</div>"
											+"</div>";
	}

	generatedFrame += "<div id=\"Z"+zone+"P"+pointId+"DataFrame\" class=\"AddData draggableFrame\" style=\"width:550px;left:10px;top:"+ (zone*20+pointId*3)*10 +"px;display:none;\">";
		generatedFrame += "<div style=\"padding:5px;background-color:#607585;color:#ffffff;border:1px solid #a0a0a0;\" class=\"theader\">";
			generatedFrame += "<div class=\"theader-title\" style=\"cursor:move;display:inline-block;font-weight:bold;width:92%;\">"
				generatedFrame += "<div style=\"cursor: move; display: inline-block; font-weight: bold; width: 92%; user-select: none;\">"+titleLabels[curr_lang]['zone']+" "+zone+", "+(!!pointTypeNumber ? titleLabels[curr_lang][pointType]+" "+pointTypeNumber : titleLabels[curr_lang][pointType])+"</div>"
				generatedFrame += "<div style=\"margin-left:520px;margin-top:-17px;cursor:pointer;opacity:0.2;\" title=\""+labels[curr_lang]['hide']+"\" onClick=\"closeFrame('#Z"+zone+"P"+pointId+"DataFrame')\">[x]</div>";
			generatedFrame += "</div>";
		generatedFrame += "</div>";
		generatedFrame += "<div class=\"content\" style=\"max-height:500px; overflow-y:auto\">";
			generatedFrame += "<div class='frameContent'>";
				generatedFrame += frameContent;
			generatedFrame += "</div>";
		generatedFrame += "</div>";
	generatedFrame += "</div>";

	$('#FlowChart').append(generatedFrame);

}

function extendSensors(sensorNum){
	$('#sensor'+sensorNum).toggleClass('extended');
};

function closeFrame(frameId) {
	$(frameId).hide().removeClass('frameVisible').css('z-index','');
};

function FlowChartCont(){
	$("#content").append(
		"<div id=\"FlowChart\"></div>"

		+"<img src=\""+SubSystem+"/fcimgs/main_img_mask.png\" class=\"msch\" id=\"basepic\">"

		+"<div id=\"FlChLabels\">"
		+"</div>"

		+"<div id=\"FlChLabels\">"
		+"</div>"
	);


	function generatePointsHtml(qty, zone) {
		var result = "";
		var pointType;
		var ventNum = 0;
		var recNum = 0;
		var incomeNum = 0;
		var pointNum = '';
		var label = '';

		for (var i=1; i <= qty; i++){

			var pointType = definePointType(i, zone);

			if (pointType === 'recycle') {
				pointNum = ++recNum;
				label = 'К';
			} else if (pointType === 'vent') {
				pointNum = ++ventNum;
				label = 'В';
			} else {
				pointNum = ++incomeNum;
				label = 'П';
			}

			generatePointData(i, zone, pointNum);

			result += "<div data-point-type=\"Z"+zone+pointType+pointNum+"\" class=\"pointButton "+pointType+"\" id=\"Z"+zone+"P"+i+"Details\" onClick=\"showPointData("+i+","+zone+")\"><div class='pointLabel'>"+label+unitNumbers['zone'+zone][definePointType(i, zone)][pointNum-1]+"</div><div class='vent-dots upper'></div><div class='vent-dots lower'></div>"
				+"<div class='vent-img'>"
					+'<svg xmlns="http://www.w3.org/2000/svg" version="1.0" width="496" height="498" viewBox="0 0 372 372" style="width:100%;height:100%"><path d="M165.5 3.1c-21.4 2.6-44.2 9.5-63 19.3C90.5 28.6 77 36.9 77 38.1c0 .3 3.9 3 8.8 6 37.1 22.8 67.1 55 84.9 91.4l5.7 11.7 5.7-.6c3.6-.4 8.3-.1 13 .8 4 .9 7.3 1.5 7.4 1.3.1-.1 2-4.5 4.2-9.7 16.6-39 21.1-74.5 13.3-104.5-2.3-8.7-9.4-24.2-13.4-29l-2.4-3-15.4-.2c-8.4-.1-18.9.3-23.3.8zM295.6 41.2c-.2.7-1.4 5.3-2.6 10.3-10.6 42.4-31.7 79.7-60.9 107.9l-8.1 7.9 2.5 6.3c1.6 4 2.7 9 3 13.6l.4 7.3 4.8.8c2.6.5 14.7.9 26.8.9 18.2.1 24-.3 33.5-2 27.2-4.9 48.1-15 63.7-30.8 10.8-10.9 10.8-10.9 7.4-24-10.2-38.5-35.9-76.5-65.8-97.2-3.6-2.5-4.2-2.7-4.7-1zM31.5 113.6c-1.6.2-6.2 1.1-10.2 2l-7.2 1.5-2.1 5.7c-14.6 39-15.8 80.7-3.3 121.5l2.6 8.8 10.6-10.4c31-30.3 66.9-50.5 105.3-59.1 6.4-1.4 12.7-2.6 14.1-2.6 2.2 0 2.8-.7 4.2-4.9.8-2.6 2.9-6.9 4.6-9.5 1.6-2.6 2.7-5.1 2.4-5.6-.3-.5-4.8-4.1-10-8-25.4-19.1-50.8-31.6-75.4-37.1-8.3-1.8-29.5-3.2-35.6-2.3zM138.5 215.2c-30.2 20.4-54.1 46.2-65 70.3-5.2 11.4-8.5 24.7-8.8 35.1l-.2 8.8 6 4.9c20.7 16.8 47.7 29.7 76.1 36.3 9.8 2.2 15 2.8 29.1 3.2l17.2.4-4.9-9.8c-15.7-31.8-23.6-62.5-24.7-95.4-.5-14.4.5-31.5 2.3-39.5.3-1.5-.8-2.8-4.6-5.4-2.8-1.8-6.7-5.7-8.7-8.5-2-2.8-3.9-5.4-4.2-5.8-.4-.4-4.7 2-9.6 5.4zM212.6 223.6c-3.2 2.4-8 5.2-10.7 6.1-2.7 1-4.9 2.1-4.9 2.6 0 2.2 5.4 21.5 8.5 30.8 14.3 41.2 39.6 72.5 67.7 83.6l7 2.7 4.3-2.4c6.8-3.7 19.1-13.2 28.9-22.2 16.3-15.1 29.5-32.7 39.8-53.3 5.3-10.5 11.5-26.2 10.7-26.9-.2-.2-3.5.1-7.4.6-11.7 1.7-48.4 1.3-61-.6-24.2-3.7-44.3-9.9-64-19.7-6.6-3.2-12.3-5.9-12.5-5.8-.3 0-3.1 2-6.4 4.5z" style="fill: #394d5c;"/></svg>'
				+"</div>"
				+'<div class="Z'+zone+pointType+pointNum+'alarm alarmSign">'
					+'<svg version="1.0" xmlns="http://www.w3.org/2000/svg" fill="#f00" viewBox="0 0 490 420"><g xmlns="http://www.w3.org/2000/svg"><path stroke="#000" d="M40.377 391.568l206.5-354 206.5 354h-413z" stroke-width="1.5" fill="#fff"/><path d="M237 4.2c-3.1 1.6-5.3 3.8-7.4 7.3-11.7 20.1-30.5 52.4-32.8 56.5-1.1 1.9-4.2 7.2-6.9 11.6-2.7 4.5-4.9 8.6-4.9 9.2 0 .6-.4 1.2-.8 1.4-.4.1-3.4 4.8-6.6 10.3-3.1 5.5-6.7 11.6-7.8 13.5-5.7 9.7-17.4 29.9-19.6 33.9-1.4 2.5-4 7-5.9 9.9-1.8 2.9-3.3 5.5-3.3 5.7 0 .3-4.2 7.6-9.3 16.2-9.8 16.5-24 40.6-38.5 65.3-4.7 8-10.4 17.6-12.7 21.5-2.4 3.8-5.3 8.8-6.5 11-1.2 2.2-7 12.1-12.8 22-5.8 9.9-11 18.9-11.6 20-.6 1.1-1.3 2.2-1.6 2.5-.3.3-1.6 2.5-2.9 5-1.3 2.5-5.3 9.4-8.9 15.5-3.6 6-8.3 14.1-10.5 18-2.2 3.8-5 8.6-6.2 10.5-8.1 13.1-16.5 27.9-17 30.3-.4 1.5-.4 4.2-.1 6.1.8 4 6.4 10.3 9.7 11 6.7 1.4 38.8 1.6 241.1 1.6 241.9.1 224 .6 229.1-6.1 3.8-5.1 4.3-9.7 1.7-15-2.5-4.9-40.9-71.3-44.6-77.1-1.3-2.1-2.4-4-2.4-4.3 0-.2-1.7-3.3-3.9-6.8-2.1-3.4-10.3-17.5-18.3-31.2-8-13.8-18.5-31.8-23.3-40-4.8-8.3-9.7-16.6-10.8-18.5-1.1-1.9-5.7-9.8-10.2-17.5-4.5-7.7-11.2-19.2-14.8-25.5-3.6-6.3-11.6-20.1-17.7-30.5-13-22-14.4-24.4-17.8-30.5-1.4-2.5-5.5-9.7-9.2-16-3.7-6.3-7.7-13.4-8.9-15.8-1.2-2.3-2.6-4.2-3.1-4.2-.6 0-1-.5-1-1.2 0-1-20.2-36.6-25.5-44.8-1.3-1.9-2.4-4-2.6-4.5-1.7-4.6-13.8-23.1-16.5-25.2-4.8-3.6-10.7-4-16.4-1.1zm12.3 53c4 6.7 9.3 15.6 13.7 23.4 1 1.6 5.3 9.1 9.6 16.5 9.3 16.1 12.1 20.9 33.9 58.4 9.2 15.9 17.6 30.2 18.6 31.7 1.1 1.4 1.9 2.9 1.9 3.3 0 .6 8 14.5 20.7 35.6 3.4 5.9 6.3 10.9 6.3 11.3 0 .3 2.5 4.6 5.5 9.4 3 4.9 5.5 9.4 5.5 10 0 .7.4 1.2.8 1.2s1.3 1.2 1.9 2.7c.7 1.6 1.8 3.7 2.5 4.7 2.9 4.3 7.8 12.5 7.8 13 0 .2 4 7.1 8.9 15.3 4.8 8.1 9.8 16.6 11 18.8 1.2 2.2 3 5.5 4.1 7.2 1.1 1.8 2.9 4.8 4 6.5 1.1 1.8 2.8 4.9 3.8 6.8 1 2 3.4 6.2 5.4 9.5 6.9 11.5 13.6 23.1 16.3 28 1.5 2.8 4.3 7.6 6.1 10.8 1.9 3.2 3.4 6.3 3.4 6.9 0 1.2-392.9.8-393.6-.4-.3-.4.5-2.5 1.8-4.7s6.8-11.7 12.3-21.3c5.4-9.5 12.1-20.8 14.7-25 2.6-4.3 4.8-8 4.8-8.4 0-.5 8.5-14.8 12-20.4.6-.8 1.4-2.5 2-3.7.7-1.7 7.4-13 12-20.3.5-.8 1.7-2.9 2.6-4.5.9-1.7 7.4-12.7 14.4-24.5 29.1-49.2 32.9-55.7 34.1-58.3.7-1.5 1.6-2.7 2.1-2.7.4 0 .8-.4.8-.9s3-6 6.6-12.3c3.7-6.2 9-15.4 11.9-20.3 2.9-5 8.2-14 11.8-20.1 6.4-10.8 8.2-14 13.5-23.4 3.4-6 33-56.7 35.4-60.5 1-1.7 2.1-3.8 2.4-4.8.4-.9 1-1.7 1.4-1.7.4 0 2.8 3.3 5.3 7.2z" style="&#10;    fill: red;&#10;"/><path d="M236.8 136.2c-2 .5-5.5 2.5-7.7 4.5-7.4 6.3-9.4 12.7-8 25.2.5 4.3 1.6 15.4 2.4 24.7.8 9.3 2 21.6 2.5 27.4.5 5.8 1.6 18.4 2.5 28 3.8 43 3.9 43.9 7.2 47.1 3.7 3.8 8.8 4.7 13.6 2.4 7-3.3 6.1 1.9 14.7-91.5 4.4-47.7 4.5-49.9 2.8-54-4.9-11.6-17.2-17.2-30-13.8zM236.2 320.8c-16.7 6-21.2 25.6-8.7 38.7 9.3 9.6 24.8 9.6 33.6-.2 5.5-6 6.4-8.4 6.4-16.3s-.9-10.3-6.4-16.3c-6-6.7-16-9-24.9-5.9z"/></g></svg>'
				+'</div>'
			+"</div>";
		}

		return result;
	}

	function generateZonesHtml(qty){
		var result = '';

		for (var i=1; i<=qty; i++){
			result += 
			'<div class="zoneInfo" id="zone'+i+'Info" data-zone="'+i+'" onClick="showZoneControls(this)">'
				+'<div class="zoneInfoTitle">'
					+titleLabels[curr_lang].zone+' '+i
					+'<div class="zone'+i+'alarm alarmSign">'
						+'<svg version="1.0" xmlns="http://www.w3.org/2000/svg" fill="#f00" viewBox="0 0 820 450"><path d="M403 42.2c-3.1 1.6-5.3 3.8-7.4 7.3-11.7 20.1-30.5 52.4-32.8 56.5-1.1 1.9-4.2 7.2-6.9 11.6-2.7 4.5-4.9 8.6-4.9 9.2 0 .6-.4 1.2-.8 1.4-.4.1-3.4 4.8-6.6 10.3-3.1 5.5-6.7 11.6-7.8 13.5-5.7 9.7-17.4 29.9-19.6 33.9-1.4 2.5-4 7-5.9 9.9-1.8 2.9-3.3 5.5-3.3 5.7 0 .3-4.2 7.6-9.3 16.2-9.8 16.5-24 40.6-38.5 65.3-4.7 8-10.4 17.6-12.7 21.5-2.4 3.8-5.3 8.8-6.5 11-1.2 2.2-7 12.1-12.8 22-5.8 9.9-11 18.9-11.6 20-.6 1.1-1.3 2.2-1.6 2.5-.3.3-1.6 2.5-2.9 5-1.3 2.5-5.3 9.4-8.9 15.5-3.6 6-8.3 14.1-10.5 18-2.2 3.8-5 8.6-6.2 10.5-8.1 13.1-16.5 27.9-17 30.3-.4 1.5-.4 4.2-.1 6.1.8 4 6.4 10.3 9.7 11 6.7 1.4 38.8 1.6 241.1 1.6 241.9.1 224 .6 229.1-6.1 3.8-5.1 4.3-9.7 1.7-15-2.5-4.9-40.9-71.3-44.6-77.1-1.3-2.1-2.4-4-2.4-4.3 0-.2-1.7-3.3-3.9-6.8-2.1-3.4-10.3-17.5-18.3-31.2-8-13.8-18.5-31.8-23.3-40-4.8-8.3-9.7-16.6-10.8-18.5-1.1-1.9-5.7-9.8-10.2-17.5-4.5-7.7-11.2-19.2-14.8-25.5-3.6-6.3-11.6-20.1-17.7-30.5-13-22-14.4-24.4-17.8-30.5-1.4-2.5-5.5-9.7-9.2-16-3.7-6.3-7.7-13.4-8.9-15.8-1.2-2.3-2.6-4.2-3.1-4.2-.6 0-1-.5-1-1.2 0-1-20.2-36.6-25.5-44.8-1.3-1.9-2.4-4-2.6-4.5-1.7-4.6-13.8-23.1-16.5-25.2-4.8-3.6-10.7-4-16.4-1.1zm12.3 53c4 6.7 9.3 15.6 13.7 23.4 1 1.6 5.3 9.1 9.6 16.5 9.3 16.1 12.1 20.9 33.9 58.4 9.2 15.9 17.6 30.2 18.6 31.7 1.1 1.4 1.9 2.9 1.9 3.3 0 .6 8 14.5 20.7 35.6 3.4 5.9 6.3 10.9 6.3 11.3 0 .3 2.5 4.6 5.5 9.4 3 4.9 5.5 9.4 5.5 10 0 .7.4 1.2.8 1.2s1.3 1.2 1.9 2.7c.7 1.6 1.8 3.7 2.5 4.7 2.9 4.3 7.8 12.5 7.8 13 0 .2 4 7.1 8.9 15.3 4.8 8.1 9.8 16.6 11 18.8 1.2 2.2 3 5.5 4.1 7.2 1.1 1.8 2.9 4.8 4 6.5 1.1 1.8 2.8 4.9 3.8 6.8 1 2 3.4 6.2 5.4 9.5 6.9 11.5 13.6 23.1 16.3 28 1.5 2.8 4.3 7.6 6.1 10.8 1.9 3.2 3.4 6.3 3.4 6.9 0 1.2-392.9.8-393.6-.4-.3-.4.5-2.5 1.8-4.7s6.8-11.7 12.3-21.3c5.4-9.5 12.1-20.8 14.7-25 2.6-4.3 4.8-8 4.8-8.4 0-.5 8.5-14.8 12-20.4.6-.8 1.4-2.5 2-3.7.7-1.7 7.4-13 12-20.3.5-.8 1.7-2.9 2.6-4.5.9-1.7 7.4-12.7 14.4-24.5 29.1-49.2 32.9-55.7 34.1-58.3.7-1.5 1.6-2.7 2.1-2.7.4 0 .8-.4.8-.9s3-6 6.6-12.3c3.7-6.2 9-15.4 11.9-20.3 2.9-5 8.2-14 11.8-20.1 6.4-10.8 8.2-14 13.5-23.4 3.4-6 33-56.7 35.4-60.5 1-1.7 2.1-3.8 2.4-4.8.4-.9 1-1.7 1.4-1.7.4 0 2.8 3.3 5.3 7.2z"/><path d="M402.8 174.2c-2 .5-5.5 2.5-7.7 4.5-7.4 6.3-9.4 12.7-8 25.2.5 4.3 1.6 15.4 2.4 24.7.8 9.3 2 21.6 2.5 27.4.5 5.8 1.6 18.4 2.5 28 3.8 43 3.9 43.9 7.2 47.1 3.7 3.8 8.8 4.7 13.6 2.4 7-3.3 6.1 1.9 14.7-91.5 4.4-47.7 4.5-49.9 2.8-54-4.9-11.6-17.2-17.2-30-13.8zM402.2 358.8c-16.7 6-21.2 25.6-8.7 38.7 9.3 9.6 24.8 9.6 33.6-.2 5.5-6 6.4-8.4 6.4-16.3s-.9-10.3-6.4-16.3c-6-6.7-16-9-24.9-5.9z"/></svg>'
					+'</div>'
				+'</div>'
				+'<div class="actualityDisclaimer">'
					+'<div>Связь потеряна</div>'
					+'<div>Данные устарели</div>'
				+'</div>'
				+'<div class="zoneInfoContent">'
					+'<div class="zoneTemp">'+titleLabels[curr_lang].temperature+': <span data-variable-name="Z'+i+(i === 1 || i === 3 ? 'BACURVAL' : 'B6CURVAL')+'">'+generateRowValue(VarGroup['Z'+i+(i === 1 || i === 3 ? 'BACURVAL' : 'B6CURVAL')], 'Z'+i+(i === 1 || i === 3 ? 'BACURVAL' : 'B6CURVAL'))+'</span></div>'
					// TODO - place modes in variable for localization
					+'<div class="zoneMode">'+titleLabels[curr_lang].mode+': <span data-variable-name="Z'+i+'OPRGMODE">'+(VarValues['Z'+i+'OPRGMODE'] == 1 ? 'Вентиляция' : VarValues['Z'+i+'OPRGMODE'] == 2 ? 'Нагрев' : VarValues['Z'+i+'OPRGMODE'] == 3 ? 'Охлаждение' : 'ОТКЛ')+'</span></div>'
					+'<div class="zoneControls">'
						+'<div class="alarmsList"></div>'
						+'<div style="display:flex; margin-top:5px;">'
							+'<input class="hiddenRadio" type="radio" data-var-control="Z'+i+'OPRGMODE" id="zone'+i+'-0" name="zone'+i+'-control" '+(VarValues['Z'+i+'OPRGMODE'] == 0 ? 'checked=checked' : '')+' value="0"><label class="radioButton" for="zone'+i+'-0">ВЫКЛ</label>'
							+'<input class="hiddenRadio" type="radio" data-var-control="Z'+i+'OPRGMODE" id="zone'+i+'-1" name="zone'+i+'-control" '+(VarValues['Z'+i+'OPRGMODE'] == 1 ? 'checked=checked' : '')+' value="1"><label class="radioButton" for="zone'+i+'-1">Вентиляция</label>'
							+'<input class="hiddenRadio" type="radio" data-var-control="Z'+i+'OPRGMODE" id="zone'+i+'-2" name="zone'+i+'-control" '+(VarValues['Z'+i+'OPRGMODE'] == 2 ? 'checked=checked' : '')+' value="2"><label class="radioButton" for="zone'+i+'-2">Нагрев</label>'
							+'<input class="hiddenRadio" type="radio" data-var-control="Z'+i+'OPRGMODE" id="zone'+i+'-3" name="zone'+i+'-control" '+(VarValues['Z'+i+'OPRGMODE'] == 3 ? 'checked=checked' : '')+' value="3"><label class="radioButton" for="zone'+i+'-3">Охлаждение</label>'
						+'</div>'
						+'<div style="margin-top:5px;">'
							+'<button onClick="switchZoneMode('+i+', event)" style="margin:0 4px;">Save</button>'
							+'<button onClick="cancelModeSwitching('+i+', event)" style="margin:0 4px;">Cancel</button>'
						+'</div>'
					+'</div>'
				+'</div>'
				// +'<a href="#" style="display:block; position:absolute; top:0; bottom:0; left:0; right:0;" onClick="showZoneControls('+i+')"></a>'
			+'</div>'
		}

		return result;
	}

	function generateSensorsHtml(sensorsArray) {
		var result = '';

		sensorsArray.map((point, index) => {
			let elem = '';
			if (index == 3 || index == 6 || index == 7 || index == 12 || index == 16 || index == 17){
				elem = '';
			} else {
				let varNameTmp = "SP"+(('0' + (index+1)).slice(-2))+"AIRTMP";
				let varNameHmd = "SP"+(('0' + (index+1)).slice(-2))+"AIRHMD";
				elem = "<div class=\"sensorPoint\" id=\"sensor"+(index+1)+"\" onClick=\"extendSensors("+(index+1)+")\">"
					+"<div class='sensorTmp'>"
						+"<span class=\"extendedTitle\">"+titleLabels[curr_lang].temperature+":</span>"
						+"<span class=\"condensedTitle\">t:</span>"
						+"<span id=\""+varNameTmp+"\">-</span>"+(VarGroup[varNameTmp] ? VarGroup[varNameTmp].dataunits : '')
					+"</div>"
					+"<div class='sensorHmd'>"
						+"<span class=\"extendedTitle\">"+titleLabels[curr_lang].humidity+":</span>"
						+"<span class=\"condensedTitle\">φ:</span>"
						+"<span id=\""+varNameHmd+"\">-</span>"+(VarGroup[varNameHmd] ? VarGroup[varNameHmd].dataunits : '')
					+"</div>"
				+"</div>";
			}
			result += elem;
		});

		return result;
	}

	//on main image load place labels
	$("#basepic").on('load', function(){
		$("#FlChLabels").html(""
		// Points data buttons
			+generatePointsHtml(6,1)
			+generatePointsHtml(3,2)
			+generatePointsHtml(6,3)
			+generatePointsHtml(3,4)
			+generatePointsHtml(3,5)
			+generatePointsHtml(3,6)

		// Zone areas
			+generateZonesHtml(6)

		// Sensor points
			+generateSensorsHtml(sensorsCoord)

		);
		
		placelabels();
	});

	placelabels();


	setTimeout(function() {
		$(".draggableFrame").draggable({handle:".theader",containment:"#content",scroll:true});
		$(".AddData").mousedown(function(){
			$(".AddData").css("z-index","9");
			$(this).css("z-index",parseInt($(this).css("z-index"))+1);
		});
	},500);

	setInterval(function(){placelabels();},500);

	setInterval(function(){

		if(SrvStat["mb"]["scanning"] == "true"){
			for (key in VarGroup) {
				if (VarGroup.hasOwnProperty(key)){
					if (VarGroup[key].actual != "0") {
						$('[data-variable-name='+key+']').removeClass('notActualValue');
					}

					// $('.zoneInfo .alarmSign').removeClass('visible');
					checkAlarmState(key);
				}
			}

			$('.frameVisible .row[data-variable-name]').each(function() {
				var varName = $(this).data('variable-name');
				$(this).find('.rowValue').html(
					generateRowValue(VarGroup[varName], varName)
					+'<div class="actualityDisclaimer">'
						+'Устаревшее значение'
					+'</div>'
				);
			});

			$('.statusIcon[data-variable-name]').each(function() {
				var varName = $(this).data('variable-name');
			});

			for (key in VarGroup) {
				if (VarGroup.hasOwnProperty(key)){
					var zone = key.substr(1,1);
					var type = '';
					if (key.substr(2,3) === "REC"){
						type = 'recycle';
					} else if (key.substr(2,3) === "EXH") {
						type = 'vent';
					} else if (key.substr(2,3) === "FAR") {
						type = 'incom';
					}
					var pointNum = key.substr(5,1);
					if (pointNum === 'U'){
						pointNum = 1;
					}
					if (type.length) {
						// VarValues["Z1FARUSTRT"] = "1";
						// VarValues["Z1FARURBLK"] = "1";
						var selector = (zone == 1 || zone == 3) ? '[data-point-type="Z'+zone+type+pointNum+'"]' : '[data-point-type="Z'+zone+type+'1"]';
						var elem = $(selector);
						var blocked = (key.substr(6,4) === "RBLK" && VarValues[key] != '0');
						if (key.substr(6,4) === "RBLK") {
							if (VarValues[key] != '0') {
								elem.addClass('blocked');
							} else {
								elem.removeClass('blocked');
							}
						}
						if (key.substr(6,4) === "STRT") {
							if (VarValues[key] != '0') {
								elem.addClass('active');
							} else {
								elem.removeClass('active');
							}
						}
					}
				}
			}

			$('.zoneInfoContent [data-variable-name]').each(function() {
				var varName = $(this).data('variable-name');
				if (varName.includes('OPRGMODE')){
					// TODO - place modes in variable for localization
					var mode = VarValues[varName] == 1 ? 'Вентиляция' : VarValues[varName] == 2 ? 'Нагрев' : VarValues[varName] == 3 ? 'Охлаждение' : 'ОТКЛ';
					$('.zoneControls:not(.visible) input[data-var-control="'+varName+'"][type="radio"][value="'+VarValues[varName]+'"]').prop("checked", true);
					$(this).html(mode);
				} else {
					$(this).html(generateRowValue(VarGroup[varName], varName));
				}
			});

			$('.actualityDisclaimer').hide();

			sensorsCoord.map((point, index) => {
				var varNameTmp = "SP"+(('0' + (index+1)).slice(-2))+"AIRTMP";
				var varNameHmd = "SP"+(('0' + (index+1)).slice(-2))+"AIRHMD";
				$('#'+varNameTmp).html(VarValues[varNameTmp]);
				$('#'+varNameHmd).html(VarValues[varNameHmd]);
			});

			placelabels();
		} else {

			// this code will mark not actual rows with class

			$('.actualityDisclaimer').show();

			for (key in VarGroup) {
				if (VarGroup.hasOwnProperty(key)){
					if (VarGroup[key].actual === "0") {
						$('[data-variable-name='+key+']').addClass('notActualValue');
					}
				}
			}
		}

	}, 1000);

}